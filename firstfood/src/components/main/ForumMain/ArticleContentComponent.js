import React from 'react'
import {
  addCollectionByForumId,
  subCollectionByForumId,
} from '../../../action/forumAction'
import { connect } from 'react-redux'

class ArticleContentComponent extends React.Component {
  constructor(props) {
    super(props)
    this.state = {
      isGood: false,
      isLove: false,
      cust_id: '',
      art_id: '',
    }
  }
  componentDidMount() {
    const content = this.props.content
    this.refs.content.innerHTML = '<p>' + content + '</p>'
    const artId = this.props.match.params.art_id
    let custId = ''
    if (this.props.isLogin) {
      // const custId = localStorage.getItem('memberId')
      custId = this.props.member[0].customer_id
      const type = ['collect', 'good']
      type.map(item => {
        const data = {
          customer_id: custId,
          forum_id: artId,
          collect_good_Type: item,
        }
        fetch(`http://localhost:6003/api/forum/getCollectionByCustomerId`, {
          method: 'POST',
          headers: new Headers({
            Accept: 'application/json',
            'Content-Type': 'application/json',
          }),
          body: JSON.stringify(data),
        })
          .then(response => {
            return response.json()
          })
          .then(rs => {
            if (item === 'good') {
              this.setState({
                isGood: rs.result,
              })
            }
            if (item === 'collect') {
              this.setState({
                isLove: rs.result,
              })
            }
          })
      })
    }

    this.setState({
      custId: custId,
      art_id: artId,
    })
  }

  componentDidUpdate() {
    const content = this.props.content
    this.refs.content.innerHTML = '<p>' + content + '</p>'
    let date = new Date(this.props.article_time)

    const year = date.getFullYear()
    const month =
      date.getMonth() + 1 < 10 ? '0' + date.getMonth() + 1 : date.getMonth() + 1
    const date_str = date.getDate() < 10 ? '0' + date.getDate() : date.getDate()
    const hour = date.getHours() < 10 ? '0' + date.getHours() : date.getHours()
    const min =
      date.getMinutes() < 10 ? '0' + date.getMinutes() : date.getMinutes()
    const sec =
      date.getSeconds() < 10 ? '0' + date.getSeconds() : date.getSeconds()

    const createDate =
      year + '-' + month + '-' + date_str + ' ' + hour + ':' + min + ':' + sec
    this.refs.createDate.innerHTML = '發布時間：' + createDate
  }

  setGood() {
    if (this.state.isGood) {
      this.props.dispatch(
        subCollectionByForumId(
          this.props.member[0].customer_id,
          this.props.match.params.art_id,
          'good'
        )
      )
    } else {
      this.props.dispatch(
        addCollectionByForumId(
          this.props.member[0].customer_id,
          this.props.match.params.art_id,
          'good'
        )
      )
    }
    this.setState({
      isGood: !this.state.isGood,
    })
  }

  setLove() {
    if (this.state.isLove) {
      this.props.dispatch(
        subCollectionByForumId(
          this.props.member[0].customer_id,
          this.props.match.params.art_id,
          'collect'
        )
      )
    } else {
      this.props.dispatch(
        addCollectionByForumId(
          this.props.member[0].customer_id,
          this.props.match.params.art_id,
          'collect'
        )
      )
    }
    this.setState({
      isLove: !this.state.isLove,
    })
  }

  setGoodWithLogin() {
    if (!this.props.isLogin) {
      alert('尚未登入')
    } else {
      this.setGood()
    }
  }
  setLoveWithLogin() {
    if (!this.props.isLogin) {
      alert('尚未登入')
    } else {
      this.setLove()
    }
  }
  render() {
    // console.log(this.state.isGood)
    // console.log(this.state.isLove)
    return (
      <>
        <div className="card-article article-line">
          <div className="">
            <div className="dox_article">
              <div className="article-con">
                <div className="article-user_img">
                  <img
                    className="user-icon"
                    alt=""
                    src={`http://localhost:6003/images/${this.props.user_img}`}
                  />
                  <span className="user-name">{this.props.user_name}</span>
                </div>
              </div>
              <div className="type_con">
                <p className="title_con">{this.props.title_con}</p>
                <p className="article_time" ref="createDate"></p>
                <p className="article_icon">
                  <i className="far fa-eye art_con">
                    {' '}
                    瀏覽 {this.props.article_icon_eye}
                  </i>
                  <i className="heart-article-con">
                    {' '}
                    按讚 {this.props.article_icon_heart}
                  </i>
                  <i className="far fa-newspaper art_new">
                    留言 {this.props.article_icon_newspaper}
                  </i>
                </p>
                <hr className="type-hr"></hr>
              </div>
            </div>
          </div>
          <div className="article-con-p-p">
            {/* <div className="article-body-content"></div> */}
            <div className="article_content" ref="content"></div>
            <hr className="content-hr"></hr>
            <div>
              <div className="article-body-content">
                {this.state.isGood ? (
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="60"
                    height="60"
                    viewBox="0 0 75 75"
                    onClick={() => {
                      this.setGoodWithLogin()
                    }}
                  >
                    <defs>
                      <clipPath id="clip-Web_1920_3">
                        <rect width="74" height="75" />
                      </clipPath>
                    </defs>
                    <g
                      id="Web_1920_3"
                      data-name="Web 1920 – 3"
                      // clip-path="url(#clip-Web_1920_3)"
                    >
                      <path
                        className="good_icon_active"
                        id="ic_thumb_up_24px"
                        d="M1,28.781H6.556V12.112H1ZM31.559,13.5a2.786,2.786,0,0,0-2.778-2.778H20.016l1.32-6.348.042-.444a2.091,2.091,0,0,0-.611-1.472L19.294,1l-9.14,9.154a2.716,2.716,0,0,0-.82,1.959V26a2.786,2.786,0,0,0,2.778,2.778h12.5a2.759,2.759,0,0,0,2.556-1.695l4.195-9.793a2.744,2.744,0,0,0,.194-1.014V13.626l-.014-.014Z"
                        transform="translate(21.3 22.126)"
                        fill="#a6a6a6"
                      />
                      <g
                        id="Path_130"
                        data-name="Path 130"
                        transform="translate(0)"
                        fill="none"
                      >
                        <path
                          d="M37.167,0A37.167,37.167,0,1,1,0,37.167,37.167,37.167,0,0,1,37.167,0Z"
                          stroke="none"
                        />
                        <path
                          className="good_icon_active"
                          d="M 37.16652297973633 3.000007629394531 C 32.55274963378906 3.000007629394531 28.07858657836914 3.902938842773438 23.8682975769043 5.683738708496094 C 19.80012130737305 7.404426574707031 16.14591217041016 9.868377685546875 13.00714874267578 13.00714111328125 C 9.868385314941406 16.14590454101563 7.404434204101563 19.80011749267578 5.683738708496094 23.86827850341797 C 3.902938842773438 28.07856750488281 3 32.55274200439453 3 37.16650390625 C 3 41.78026580810547 3.902938842773438 46.25444030761719 5.683738708496094 50.46472930908203 C 7.404434204101563 54.53289031982422 9.868385314941406 58.18710327148438 13.00714874267578 61.32586669921875 C 16.14591217041016 64.46463012695313 19.80012130737305 66.92858123779297 23.8682975769043 68.64926910400391 C 28.07858657836914 70.43006896972656 32.55274963378906 71.3330078125 37.16652297973633 71.3330078125 C 41.78029632568359 71.3330078125 46.25446319580078 70.43006896972656 50.46474838256836 68.64926910400391 C 54.53292083740234 66.92858123779297 58.1871337890625 64.46463012695313 61.32589721679688 61.32586669921875 C 64.46466064453125 58.18710327148438 66.92861175537109 54.53289031982422 68.64930725097656 50.46472930908203 C 70.43010711669922 46.25444030761719 71.33304595947266 41.78026580810547 71.33304595947266 37.16650390625 C 71.33304595947266 32.55274200439453 70.43010711669922 28.07856750488281 68.64930725097656 23.86827850341797 C 66.92861175537109 19.80011749267578 64.46466064453125 16.14590454101563 61.32589721679688 13.00714111328125 C 58.1871337890625 9.868377685546875 54.53292083740234 7.404426574707031 50.46474838256836 5.683738708496094 C 46.25446319580078 3.902938842773438 41.78029632568359 3.000007629394531 37.16652297973633 3.000007629394531 M 37.16652297973633 7.62939453125e-06 C 57.69302368164063 7.62939453125e-06 74.33304595947266 16.6400146484375 74.33304595947266 37.16650390625 C 74.33304595947266 57.6929931640625 57.69302368164063 74.33300018310547 37.16652297973633 74.33300018310547 C 16.64002227783203 74.33300018310547 0 57.6929931640625 0 37.16650390625 C 0 16.6400146484375 16.64002227783203 7.62939453125e-06 37.16652297973633 7.62939453125e-06 Z"
                          stroke="none"
                          fill="#a6a6a6"
                        />
                      </g>
                    </g>
                  </svg>
                ) : (
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="60"
                    height="60"
                    viewBox="0 0 75 75"
                    onClick={() => {
                      this.setGoodWithLogin()
                    }}
                  >
                    <defs>
                      <clipPath id="clip-Web_1920_3">
                        <rect width="74" height="75" />
                      </clipPath>
                    </defs>
                    <g
                      id="Web_1920_3"
                      data-name="Web 1920 – 3"
                      // clip-path="url(#clip-Web_1920_3)"
                    >
                      <path
                        className="good_icon"
                        id="ic_thumb_up_24px"
                        d="M1,28.781H6.556V12.112H1ZM31.559,13.5a2.786,2.786,0,0,0-2.778-2.778H20.016l1.32-6.348.042-.444a2.091,2.091,0,0,0-.611-1.472L19.294,1l-9.14,9.154a2.716,2.716,0,0,0-.82,1.959V26a2.786,2.786,0,0,0,2.778,2.778h12.5a2.759,2.759,0,0,0,2.556-1.695l4.195-9.793a2.744,2.744,0,0,0,.194-1.014V13.626l-.014-.014Z"
                        transform="translate(21.3 22.126)"
                        fill="#a6a6a6"
                      />
                      <g
                        id="Path_130"
                        data-name="Path 130"
                        transform="translate(0)"
                        fill="none"
                      >
                        <path
                          d="M37.167,0A37.167,37.167,0,1,1,0,37.167,37.167,37.167,0,0,1,37.167,0Z"
                          stroke="none"
                        />
                        <path
                          className="good_icon"
                          d="M 37.16652297973633 3.000007629394531 C 32.55274963378906 3.000007629394531 28.07858657836914 3.902938842773438 23.8682975769043 5.683738708496094 C 19.80012130737305 7.404426574707031 16.14591217041016 9.868377685546875 13.00714874267578 13.00714111328125 C 9.868385314941406 16.14590454101563 7.404434204101563 19.80011749267578 5.683738708496094 23.86827850341797 C 3.902938842773438 28.07856750488281 3 32.55274200439453 3 37.16650390625 C 3 41.78026580810547 3.902938842773438 46.25444030761719 5.683738708496094 50.46472930908203 C 7.404434204101563 54.53289031982422 9.868385314941406 58.18710327148438 13.00714874267578 61.32586669921875 C 16.14591217041016 64.46463012695313 19.80012130737305 66.92858123779297 23.8682975769043 68.64926910400391 C 28.07858657836914 70.43006896972656 32.55274963378906 71.3330078125 37.16652297973633 71.3330078125 C 41.78029632568359 71.3330078125 46.25446319580078 70.43006896972656 50.46474838256836 68.64926910400391 C 54.53292083740234 66.92858123779297 58.1871337890625 64.46463012695313 61.32589721679688 61.32586669921875 C 64.46466064453125 58.18710327148438 66.92861175537109 54.53289031982422 68.64930725097656 50.46472930908203 C 70.43010711669922 46.25444030761719 71.33304595947266 41.78026580810547 71.33304595947266 37.16650390625 C 71.33304595947266 32.55274200439453 70.43010711669922 28.07856750488281 68.64930725097656 23.86827850341797 C 66.92861175537109 19.80011749267578 64.46466064453125 16.14590454101563 61.32589721679688 13.00714111328125 C 58.1871337890625 9.868377685546875 54.53292083740234 7.404426574707031 50.46474838256836 5.683738708496094 C 46.25446319580078 3.902938842773438 41.78029632568359 3.000007629394531 37.16652297973633 3.000007629394531 M 37.16652297973633 7.62939453125e-06 C 57.69302368164063 7.62939453125e-06 74.33304595947266 16.6400146484375 74.33304595947266 37.16650390625 C 74.33304595947266 57.6929931640625 57.69302368164063 74.33300018310547 37.16652297973633 74.33300018310547 C 16.64002227783203 74.33300018310547 0 57.6929931640625 0 37.16650390625 C 0 16.6400146484375 16.64002227783203 7.62939453125e-06 37.16652297973633 7.62939453125e-06 Z"
                          stroke="none"
                          fill="#a6a6a6"
                        />
                      </g>
                    </g>
                  </svg>
                )}
                {this.state.isLove ? (
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="60"
                    height="60"
                    viewBox="0 0 75 75"
                    onClick={() => {
                      this.setLoveWithLogin()
                    }}
                  >
                    <defs>
                      <clipPath id="clip-Web_1920_4">
                        <rect width="74" height="75" />
                      </clipPath>
                    </defs>
                    <g
                      id="Web_1920_4"
                      data-name="Web 1920 – 4"
                      // clip-path="url(#clip-Web_1920_4)"
                    >
                      <g
                        id="Path_130"
                        data-name="Path 130"
                        transform="translate(0)"
                        fill="none"
                      >
                        <path
                          d="M37.167,0A37.167,37.167,0,1,1,0,37.167,37.167,37.167,0,0,1,37.167,0Z"
                          stroke="none"
                        />
                        <path
                          className="love_icon_active"
                          d="M 37.16652297973633 3.000007629394531 C 32.55274963378906 3.000007629394531 28.07858657836914 3.902938842773438 23.8682975769043 5.683738708496094 C 19.80012130737305 7.404426574707031 16.14591217041016 9.868377685546875 13.00714874267578 13.00714111328125 C 9.868385314941406 16.14590454101563 7.404434204101563 19.80011749267578 5.683738708496094 23.86827850341797 C 3.902938842773438 28.07856750488281 3 32.55274200439453 3 37.16650390625 C 3 41.78026580810547 3.902938842773438 46.25444030761719 5.683738708496094 50.46472930908203 C 7.404434204101563 54.53289031982422 9.868385314941406 58.18710327148438 13.00714874267578 61.32586669921875 C 16.14591217041016 64.46463012695313 19.80012130737305 66.92858123779297 23.8682975769043 68.64926910400391 C 28.07858657836914 70.43006896972656 32.55274963378906 71.3330078125 37.16652297973633 71.3330078125 C 41.78029632568359 71.3330078125 46.25446319580078 70.43006896972656 50.46474838256836 68.64926910400391 C 54.53292083740234 66.92858123779297 58.1871337890625 64.46463012695313 61.32589721679688 61.32586669921875 C 64.46466064453125 58.18710327148438 66.92861175537109 54.53289031982422 68.64930725097656 50.46472930908203 C 70.43010711669922 46.25444030761719 71.33304595947266 41.78026580810547 71.33304595947266 37.16650390625 C 71.33304595947266 32.55274200439453 70.43010711669922 28.07856750488281 68.64930725097656 23.86827850341797 C 66.92861175537109 19.80011749267578 64.46466064453125 16.14590454101563 61.32589721679688 13.00714111328125 C 58.1871337890625 9.868377685546875 54.53292083740234 7.404426574707031 50.46474838256836 5.683738708496094 C 46.25446319580078 3.902938842773438 41.78029632568359 3.000007629394531 37.16652297973633 3.000007629394531 M 37.16652297973633 7.62939453125e-06 C 57.69302368164063 7.62939453125e-06 74.33304595947266 16.6400146484375 74.33304595947266 37.16650390625 C 74.33304595947266 57.6929931640625 57.69302368164063 74.33300018310547 37.16652297973633 74.33300018310547 C 16.64002227783203 74.33300018310547 0 57.6929931640625 0 37.16650390625 C 0 16.6400146484375 16.64002227783203 7.62939453125e-06 37.16652297973633 7.62939453125e-06 Z"
                          stroke="none"
                          fill="#a6a6a6"
                        />
                      </g>
                      <path
                        className="love_icon_active"
                        id="path2361"
                        d="M93.021,28.622C85,28.478,77.587,41.014,99.2,54.012a.091.091,0,0,1,.139,0c22.309-13.417,13.686-26.34,5.4-25.334A6.483,6.483,0,0,0,99.268,32.4,6.483,6.483,0,0,0,93.8,28.678a7.555,7.555,0,0,0-.776-.055Z"
                        transform="translate(-61.769 -2.199)"
                        fill="#a6a6a6"
                        // fill-rule="evenodd"
                      />
                    </g>
                  </svg>
                ) : (
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="60"
                    height="60"
                    viewBox="0 0 75 75"
                    onClick={() => {
                      this.setLoveWithLogin()
                    }}
                  >
                    <defs>
                      <clipPath id="clip-Web_1920_4">
                        <rect width="74" height="75" />
                      </clipPath>
                    </defs>
                    <g
                      id="Web_1920_4"
                      data-name="Web 1920 – 4"
                      // clip-path="url(#clip-Web_1920_4)"
                    >
                      <g
                        id="Path_130"
                        data-name="Path 130"
                        transform="translate(0)"
                        fill="none"
                      >
                        <path
                          d="M37.167,0A37.167,37.167,0,1,1,0,37.167,37.167,37.167,0,0,1,37.167,0Z"
                          stroke="none"
                        />
                        <path
                          className="love_icon"
                          d="M 37.16652297973633 3.000007629394531 C 32.55274963378906 3.000007629394531 28.07858657836914 3.902938842773438 23.8682975769043 5.683738708496094 C 19.80012130737305 7.404426574707031 16.14591217041016 9.868377685546875 13.00714874267578 13.00714111328125 C 9.868385314941406 16.14590454101563 7.404434204101563 19.80011749267578 5.683738708496094 23.86827850341797 C 3.902938842773438 28.07856750488281 3 32.55274200439453 3 37.16650390625 C 3 41.78026580810547 3.902938842773438 46.25444030761719 5.683738708496094 50.46472930908203 C 7.404434204101563 54.53289031982422 9.868385314941406 58.18710327148438 13.00714874267578 61.32586669921875 C 16.14591217041016 64.46463012695313 19.80012130737305 66.92858123779297 23.8682975769043 68.64926910400391 C 28.07858657836914 70.43006896972656 32.55274963378906 71.3330078125 37.16652297973633 71.3330078125 C 41.78029632568359 71.3330078125 46.25446319580078 70.43006896972656 50.46474838256836 68.64926910400391 C 54.53292083740234 66.92858123779297 58.1871337890625 64.46463012695313 61.32589721679688 61.32586669921875 C 64.46466064453125 58.18710327148438 66.92861175537109 54.53289031982422 68.64930725097656 50.46472930908203 C 70.43010711669922 46.25444030761719 71.33304595947266 41.78026580810547 71.33304595947266 37.16650390625 C 71.33304595947266 32.55274200439453 70.43010711669922 28.07856750488281 68.64930725097656 23.86827850341797 C 66.92861175537109 19.80011749267578 64.46466064453125 16.14590454101563 61.32589721679688 13.00714111328125 C 58.1871337890625 9.868377685546875 54.53292083740234 7.404426574707031 50.46474838256836 5.683738708496094 C 46.25446319580078 3.902938842773438 41.78029632568359 3.000007629394531 37.16652297973633 3.000007629394531 M 37.16652297973633 7.62939453125e-06 C 57.69302368164063 7.62939453125e-06 74.33304595947266 16.6400146484375 74.33304595947266 37.16650390625 C 74.33304595947266 57.6929931640625 57.69302368164063 74.33300018310547 37.16652297973633 74.33300018310547 C 16.64002227783203 74.33300018310547 0 57.6929931640625 0 37.16650390625 C 0 16.6400146484375 16.64002227783203 7.62939453125e-06 37.16652297973633 7.62939453125e-06 Z"
                          stroke="none"
                          fill="#a6a6a6"
                        />
                      </g>
                      <path
                        className="love_icon"
                        id="path2361"
                        d="M93.021,28.622C85,28.478,77.587,41.014,99.2,54.012a.091.091,0,0,1,.139,0c22.309-13.417,13.686-26.34,5.4-25.334A6.483,6.483,0,0,0,99.268,32.4,6.483,6.483,0,0,0,93.8,28.678a7.555,7.555,0,0,0-.776-.055Z"
                        transform="translate(-61.769 -2.199)"
                        fill="#a6a6a6"
                        // fill-rule="evenodd"
                      />
                    </g>
                  </svg>
                )}
              </div>
            </div>
          </div>
        </div>
      </>
    )
  }
}
const mapStateToProps = state => {
  return {
    isGood: state.forumReducer.isGood,
    isCollect: state.forumReducer.isCollect,
  }
}

export default connect(mapStateToProps)(ArticleContentComponent)
